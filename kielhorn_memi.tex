
%\documentclass[DIV19]{scrartcl}
%\usepackage[paper size={90mm, 120mm},left=2mm,right=2mm,top=2mm,bottom=2mm,nohead]{geometry}
% FIXME try prettyref
\documentclass[oneside,a4paper,12pt,BCOR20mm,DIV14]{scrbook} % should be DIV14
%\documentclass{book}
% this gives a bit more than 2cm margin right and 4cm left
% koma-script.pdf: A4 is 210mmx297mm, BCOR is substraced before the page
% width is divided into DIV parts (HLU), a one sided leaves 1.5 HLU
% HLU*DIV=210-BCOR -> DIV=(210-BCOR)/HLU
% I want BCOR= 20mm 1.5 HLU = 20 mm 
% -> DIV=truncate(190*1.5/20) = truncate(14.25)=14
% I could use headinclude so that the header isn't printed into the margin

% Initially two softbound theses should be submitted to the
% Examinations Office for the examiners. Softbound theses should have
% the pages glued in.
% They don't need gold lettering on the spine.

%\includeonly{spatio-angular}

%\usepackage{enumitem}
%\setitemize{noitemsep,topsep=0pt,parsep=0pt,partopsep=0pt}

%\usepackage{etoolbox}

\pdfminorversion=5
% 9 is best zlib compression i use 0 while writing in the hope that
% git can track changes more easily
\pdfcompresslevel=0
% 3 is maximum for now
\pdfobjcompresslevel=0

\usepackage{booktabs}

\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage[usenames,dvipsnames]{color}
\usepackage[onehalfspacing]{setspace} 
%\usepackage[draft]{graphicx}
\usepackage{graphicx}
\usepackage{longtable}
\usepackage{float}
\usepackage{wrapfig}
\usepackage{soul}
\usepackage{amssymb}
\usepackage{amsmath}

%\usepackage{pdfcomment}  % breaks hyperref metadata

% choose font here: http://www.tug.dk/FontCatalogue/mathfonts.html
\usepackage[T1]{fontenc}
%\usepackage[math]{iwona}
\usepackage[math]{kurier}
%\usepackage{cmbright}
\usepackage[scaled]{beramono}

\usepackage{footnote}

\usepackage{microtype}
\newcommand\Small{\fontsize{9}{9.2}\selectfont}
\newcommand*\LSTfont{\Small\ttfamily\SetTracking{encoding=*}{-60}\lsstyle}
\newcommand*\cmafont{\fontsize{8}{8.2}\selectfont\ttfamily\SetTracking{encoding=*}{-60}\lsstyle}


\usepackage{esvect} % vector CB in raytrace chapter



%\newcont\pdfcompresslevel


%\usepackage[hypertex,breaklinks]{hyperref} 
% breaklinks only seems to work with dvipdfm,
% otherwise urls have no
% line breaks

%\usepackage[showrefs,showcites,ignoreunlbld]{refcheck} % for draft, uncomment for final
%\usepackage[notref,notcite]{showkeys}

\usepackage[disable]{todonotes} % for draft, disable for final

\usepackage{lineno}
\usepackage[refpage]{nomencl}
%\special{background Black}\special{color Green}
%\usepackage[utf8x]{inputenc} 
%\usepackage[T2A]{fontenc} % for the russian reference
\usepackage{wasysym} %diameter
% http://www.andy-roberts.net/misc/latex/latextutorial3.html

%\usepackage{url} % natbib.pdf p.11 break urls up, seems to be done
                 % with hyperref, though

\usepackage{natbib}

\usepackage[pdftex,a4paper=true,plainpages,bookmarksnumbered,pagebackref,% put after natbib
pdftitle={Spatio-Angular Microscopy},%
pdfauthor={Martin Kielhorn},%
pdfkeywords={microscopy, photobleaching,%
  phototoxicity, spatial light modulator}, %
pdfsubject={PhD thesis}]{hyperref}


\usepackage{siunitx} %sudo apt-get install texlive-science
\usepackage{units}


% for app_hilo
\usepackage{listings}
\usepackage{color}
\usepackage{textcomp}
\usepackage{subfigure}


% \listfiles % show which files are loaded by tex

\bibpunct{(}{)}{;}{a}{}{,}
\makenomenclature
\newcommand{\vect}[1]{\mathbf{#1}}
\renewcommand{\r}{\vect r}
\renewcommand{\a}{\vect a}
\newcommand{\s}{\vect s}
\newcommand{\vnu}{\mbox{\boldmath{$\nu$}}}
\newcommand{\vmu}{\mbox{\boldmath{$\mu$}}}
\newcommand{\vtau}{\mbox{\boldmath{$\tau$}}}
\newcommand{\vrho}{\mbox{\boldmath{$\rho$}}}
\newcommand{\vvarrho}{\mbox{\boldmath{$\varrho$}}}
\newcommand{\supp}{\mathop{\mathrm{supp}}}
\newcommand{\pois}{\mathop{\mathrm{pois}}}
\newcommand{\step}{\mathop{\mathrm{step}}}
\newcommand{\diag}{\mathop{\mathrm{diag}}}
\def\k{\vect k}
\def\d{\vect d}
\def\e{\vect e}
\def\f{\vect f}
\def\c{\vect c}
\def\x{\vect x}
\def\y{\vect y}
\def\z{\vect z}
\def\q{\vect q}
\def\p{\vect p}
\def\l{\vect l}

\newcommand{\nvect}[1]{\vect{\hat{#1}}}
%\renewcommand{\i}{\nvect i}
\newcommand{\vi}{\nvect \i}
\def\hc{\nvect c}
\def\hs{\nvect s}
\def\hd{\nvect d}
\def\hx{\nvect x}
\def\hy{\nvect y}

\def\hz{\nvect z}
\def\n{\nvect n}
\def\t{\nvect t}
\def\m{\nvect m}
\def\vrho{\boldsymbol\rho}
\def\abs#1{\mathopen| #1 \mathclose|}


\renewcommand{\O}{\textsf{O}} % oxygen

% conclusions of paragraphs in the margin
%\usepackage[marginparwidth=2.5cm]{geometry}
\setlength{\marginparwidth}{2.2\marginparwidth}
\reversemarginpar
\newcommand{\cma}[1]{\marginpar{\cmafont{#1}}}
% include eps or pdf file, that was generated by inkscape, depending
% on if pdflatex or latex processes this file. latex allows a faster
% development cycle but pdflatex generates a smaller and better final
% pdf output
\def\svgending{\ifx\pdfoutput\undefined% 
  .eps_tex% 
  \else%
  .pdf_tex%
  \fi}

% use \svginput{1}{bla} to include bla.svg, make sure you keep this in
% one line, so that make can automatically find the dependencies with
% sed
\newcommand{\svginput}[2]{{\def\svgscale{#1}\input{#2\svgending}}}

\def\pdfending{\ifx\pdfoutput\undefined% 
  _vector.eps% 
  \else%
  _vector%
  \fi}
\newcommand{\pdfinput}[2]{\includegraphics[width=#1]{#2\pdfending}}

% example call \imagw{8cm}{bla.jpg}{bla}{caption abl}
\newcommand{\imagw}[4]{
  \begin{figure}[!hbt]
    \centering
    \includegraphics[width=#1]{#2}
    \caption{#4}
    \label{fig:#3}
  \end{figure}
}

\def\jpgending{\ifx\pdfoutput\undefined% 
  .eps% 
  \else%
  %
  \fi}
% use like this \jpginput{8cm}{imagefile}{caption ...  make sure all
% characters until the opening brace for the caption are on one line
\newcommand{\jpginput}[3]{\imagw{#1}{#2\jpgending}{#2}{#3}}

% this is for plots that are generated by gnuplot
\newcommand{\gnuplotinput}[2]{\begin{figure}[!hbt]%
    \centering%
    \includegraphics{#1_gnuplot}%
    \caption{#2}%
    \label{fig:#1}%
  \end{figure}}

\newcommand{\celegans}{\emph{C.~elegans}}
\DeclareMathOperator{\sign}{sign}
\DeclareMathOperator*{\sinc}{sinc}
\DeclareMathOperator*{\rect}{rect}

% reference to picture
\newcommand{\figref}[1]{\figurename~\ref{#1}}
\title{Spatio-angular microscope} % i don't call make title
\author{Martin Kielhorn}
% short summary at the beginning of a section
\newenvironment{summary}{\begin{quote}\small}{\end{quote}}

\begin{document}
\listoftodos
%\linenumbers
\begin{titlepage}
  
  \hspace{-4cm}
  \svginput{1}{objective-trace}



  \vspace{-5cm}
  
  \hspace{4cm}\textsf{\Huge Spatio--Angular Microscopy}
  
  \vspace{2cm}
  \hspace{6cm}\textsf{\huge PhD Thesis}


  \vspace{3cm}
  \hspace{4cm}\textsf{\Large Martin Kielhorn}
  
  \vspace{1cm}
  \hspace{4cm}\textsf{\Large April 2013}
\end{titlepage}
\newpage
\section*{Abstract}
\begin{summary}
  Photobleaching and phototoxicity pose a problem in live cell
  imaging. Fluorescence imaging induces reactive oxygen species in
  observed organisms which can alter the behaviour of the
  sample. Hence, minimising the light exposure is an important goal.

  We augment a wide field epifluorescence microscope with two spatial
  light modulators. By controlling the spatial excitation pattern and
  the angle of illumination, we can adapt the illumination to the
  specimen. In many cases, this technique will create exposures with
  reduced excitation of the out-of-focus fluorophores, resulting in
  better image quality and less phototoxicity.

  My custom software is used to obtain an initial image stack of the
  specimen. Subsequent image sections are exposed with excitation
  patterns that account for the previous image stack. Depending
  upon the distribution of fluorophores, this adaptive exposure can
  considerably reduce photobleaching and phototoxicity.
\end{summary}

\urlstyle{sf}
%\setcounter{tocdepth}{3}

\chapter*{Preface}
%\section*{Preface}

The work described in this thesis was carried out between June 2008
and April 2013.

In chapter \ref{sec:intro}, we introduce photophysics of fluorescence
and emphasize the importance of oxygen for phototoxicity. Furthermore,
we also explain conventional microscopes and CCD cameras.

In chapter \ref{sec:approaches}, we compare some state-of-the-art
techniques for illumination control in microscopes.  Particularly in
section \ref{sec:light-field-microscopy}, we discuss the micro-lens
based light field microscope by Levoy's computational photography
group, which imaged the toy soldier in 2003.

In chapter \ref{sec:setup}, we describe our microscope and in chapter
\ref{sec:experiments}, we show some images, taken with illumination
control in our prototype.

- ccd measurment

- mapping lcos camera

In the appendix, we also describe a completely different approach for
spatio--angular illumination based on holography (Appendix
\ref{sec:app_holo}) and we document an interferometric attempt to
convert our precise programmable phase mask into a spatial intensity
modulator (Appendix \ref{sec:app_dic}).

Note that the Appendix \ref{sec:dvi} describes a modification of our
prototype with a spatial light modulator that receives data from a
graphics card. A higher bandwidth makes this approach more useful than
the prototype described in the main text and we tried to implement
this first. However eventually, it proved too difficult to trigger the
components in this configuration and we switched to the more
predictable USB-controlled display as described in the main body of
the text.
 
The appendix also contains some theoretical explainations of
raytracing (Appendix \ref{sec:raytrace}), computational optical
sectioning (Appendix \ref{sec:app_hilo}) and the wave-optics based
simulation of our microscope (Appendix \ref{sec:sim-angle}).

\subsection*{Source Code Availability}

Source code that has been developed during this project is available
on \url{https://github.com/plops/mma}.  It contains implementations
for:
\begin{itemize}
\item illumination planning based on raytraces (see Appendix
  \ref{sec:raytrace})
\item moving the $z-$stage of a Zeiss Axiovert 200M microscope body
\item controlling an Andor Clara camera using the Andor SDK version
  2. For the other cameras following below, control software was written:
  \begin{itemize}
  \item Photometrics Cascade~II (interface to unsupported
    closed-source driver, only works on very old 32-bit Linux kernels)
  \item mvBlueFox 102G using the SDK
  \item Logitech Pro 9000 using a generic Video4Linux interface
  \item Andor sCMOS using Andor SDK version 3
  \end{itemize}
\item displaying patterns using a graphics card that supports OpenGL
  on a ForthDD SXGA ferroelectric LCoS display
\item controlling a stand-alone ForthDD WXGA 3DM display controller
  using USB
\item estimating the parameters of a rigid transformation between
  camera and LCoS display (see Appendix \ref{sec:rigid}),
\item controlling the micromirror array by Fraunhofer IPMS using
  their SDK
\item some specific image processing tools:
  \begin{itemize}
  \item three-dimensional convolution and Fourier transforms
  \item drawing of lines and ellipsoids in volumes
  \item rasterization of triangles (for creating shadow maps in the
    BFP, see section \ref{sec:trace-detect})
  \item calculation of optical transfer function for high NA
    objectives
  \item localization of spherical nuclei in volumetric data (parts of
    the algorithm as described in \citet{Santella2010})
  \end{itemize}
\end{itemize}
The main development was done using GNU~Linux. However, portability
was kept in mind and most of the code was made to work with Microsoft
Windows as well.

The drawing on the title page shows the beam path through at
$100\times$ objective with a numerical aperture of 1.45. The design
parameters of the objectives that I used in this project are hard to
come by and I used data from a patent \citep{Matthae2003}.


\subsection*{Acknowledgements}
It is my pleasure to thank all those who have made this thesis
possible. First and foremost, I owe my deepest gratitude to my
supervisor Rainer Heintzmann for giving me the opportunity to become
part of his research group at King's College London and later in the
Institute of Photonic Technology in Jena.

I owe my sincere thanks to Kai Wicker, Jakub Nedbal, Susan Cox, Daniel
Appelt, Ond\v rej Mandula, Ronny F\"orster, Ivana \v Sumanovac,
Eckhard Birkner, Kathrin Klehs and all the other members of our group
for valuable discussions, support and review of the manuscript.

My sincere thanks to the European Union Framework Programme 7 (project
number 2115597) for the studentship on this project.  I also thank
Erhard Ipp, G\"unter Z\"ochling, Vincent Galy, QueeLim Ch'ng, J\"org
Heber, Mark Eckert, Dirk Berndt, Joel Seligson, Jean-Yves Tinevez and
Florian R\"uckerl for helpful collaboration.

Furthermore I highly appreciate the input of Herbert Gross, Miroslav
Grajcar, Edward Rosten, Christophe Rhodes, Paul Khuong, Nikodemus
Siivola, Gabor Melis and Lu\' is Oliveira. Occasionally, the expertise
and insight of them steered me into right direction or greatly
simplified problems I faced.

Finally, I wish to thank the authors and contributors to the following
software projects: Linux, GCC, Emacs, SBCL \citep{Rhodes2008}, Maxima
\citep{Maxima.sourceforge.net2013}, Micromanager
\citep{Edelstein2010}, DIPimage \citep{dipimage}, Wireshark
\citep{wireshark}, Latex, Inkscape \citep{inkscape}, Gimp
\citep{gimp}, ImageJ/Fiji \citep{Abramoff,Schindelin2012} and Blender
\cite{blender}.  These free software projects and their communities
are invaluable to my work and greatly enhance my efficiency.

The work presented in this thesis is my own, unless I cite a
reference.

\begin{flushright}
  M.~K.
\end{flushright}

\noindent
Jena, Germany

\noindent
April 2013
\newpage
\tableofcontents
\printnomenclature
\include{introduction}
\include{review}
\include{spatio-angular}
\include{device1}
%\chapter{optimization of the spatio-angular illumination patterns}
%\label{sec:optimization}
%\chapter{mma as an intensity modulator}
%\label{sec:mma}
%\include{mma}
%\include{device2}
\include{raytrace}
\include{results}
\chapter{Discussion}
\label{sec:discussion}
The aim of this thesis has been the development of a wide-field
fluorescence microscope system that can control the irradiance in the
specimen as well as the illumination angles with the aim of decreasing
phototoxicity.

The original \cma{origin of the idea} idea was to combine a
programmable array microscope with control of the illumination
directions. Initially this seemed to be an elegant approach: The
programmable array microscope produces two images on a camera, one of
which contains only out-of-focus light. By variation of the
illumination angle of the excitation light, it should be possible to
find the direction with minimal out-of-focus contributions.
 
Fairly quickly it became clear that this approach, if at all, would
work only inefficiently. After all, for the programmable array
microscope to work, fine structures must be imaged into the
specimen. This, however, has the consequence that several diffraction
orders instead of just one bundle of rays must traverse the
sample. For most specimens this will bring no advantage compared to a
wide-field microscope.

We opted instead for a modification of the excitation path in a
wide-field microscope. My assumption was that given an estimate of the
three-dimensional fluorophore distribution, and perhaps additional
information about the expected movement of cells, pathogens or organs;
a sufficiently accurate prediction of the expected out-of-focus light
can be made.

Using \cma{description of the hardware} two spatial light modulators
(SLM), we can project appropriate distributions of excitation light
into the sample. One SLM controls the angle and the other the in-focus
pattern of light. Our goal for was to acquire one stack, consisting of
twenty slices, per minute. For this, partial recordings of slices
should be acquired in sequence and later composed into one image (see
chapter \ref{sec:concept}, in particular section
\ref{sec:illum-opt}). Therefore we selected the SLM devices with an
emphasis on high speed.

The fastest commercially available SLMs are ferroelectric liquid
crystal on silicon devices (fLCoS) and digital micromirror devices
(DMD), both of which can only do binary modulation. However, in our
case binary intensity modulation is disadvantageous. Sharp edges lead
to high diffraction losses and strong oscillations of the field in the
Fraunhofer diffraction pattern.

\nomenclature{fLCoS}{Ferroelectric liquid crystal on silicon device, a
  reflective spatial light modulater based on switching liquid
  crystals between two bistable states. It is a particularly fast
  technology.}

The pupil \cma{Why Fraunhofer micromirror array?} plane SLM, that
controls the illumination angles should ideally not be a binary
device, otherwise oscillations of excitation intensity would occur in
the specimen and appear on the camera image. For this reason, we use a
specifically developed SLM, which resembles a DMD in terms of mode of
operation and speed but can display gray scale values.  A $256\times
256$ mirror array suffices for angular control. This facilitated the
development of the mirror and fast control electronics at Fraunhofer
IPMS.

The focal plane SLM, on the other hand, should have a high resolution
\cma{choice for focal plane SLM} and it should be possible to update
its patterns very fast, so that the illumination can be adapted to the
specimen during acquisition with low latency. Initially I opted for a
SLM that is connected to the graphics card of a computer. We chose a
fLCoS SLM because its pixel borders are less sharp than those of the
DMD and we expected a better efficiency for our
application. Unfortunately, there were difficulties with the
synchronization between the graphics card and the other
devices. Therefore, relatively late into the project {\color{red}
  FIXME is that an okay expression?}, I had to replace the SLM
controller with another one that contains internal memory and is
linked to a computer via USB.  \nomenclature{USB}{Universal Serial
  Bus.}  Unfortunately, the USB connection is very slow and fast
update of image patterns is no longer possible. In retrospect, it
would have been easier to use two of the custom-made grey value SLMs
from Fraunhofer. Note that Institut Pasteur and Fraunhofer IPMS
continue this work and do just that under the Joint-Programme Inter
Carnot Fraunhofer PICF 2011, ``Micromirror Enhanced Microscopic
Imaging for high-speed angular and spatial light control in spectral
Optogenetics and Photomanipulation applications in biological
applications'' (MEMI-OP).

A \cma{remedy against low acceptance angle} serious disadvantage of
the Fraunhofer SLM in combination with the Fourier optical filter
approach employed in our prototype is the small acceptance angle. This
limits the exposed field to $\unit[80]{\mu m}$ diameter for a
wavelength of \unit[473]{nm} using a $63\times$ objective with a
numerical aperture of $1.4$, while the objective does support
$\unit[400]{\mu m}$ field diameter. One solution could be contrast
generation in a common path interferometer as described in the patent
application \citep{Heintzmann2010a}. The approach is derived from
reflective Nomarski differential interference contrast microscopy. A
birefringent prism separates the illumination bundle into bundles that
have a small offset (shear).  If the shear distance corresponds to the
pixel pitch $\Lambda=\unit[16]{\mu m}$ of the micromirrors then this
device converts height differences between adjacent mirrors into
intensity contrast. My experiments with a set of Nomarski prisms that
were available in our lab showed that this method can work. However,
the prisms had too small a shear angle and returning diffraction
orders were cut off. Meanwhile planning for the original, and with
respect to acceptance slightly flawed, prototype had advanced so far
that the change of the contrast method no longer seemed possible and
the project consortium decided to abandon the development of this
alternative contrast method. However, the common path interferometer
is still a very promising method and has the potential for good
contrast at large acceptance angles when prisms with larger shear
angles are used. Additionally, it should be noted that this
interferometric method will work better when using piston-type
micromirrors as compared to torsion micromirrors.

Given \cma{priority of the control algorithm} the \emph{low
  transmission} of our prototype, which could be just barely enough to
investigate the biological test system of \celegans\ embryos, the
disproportionally high effort that went into synchronizing the two
fast SLMs which can only run at a \emph{reduced duty cycle}, and the
\emph{limited etendue} which excludes some interesting experiments, it
would have been better in hindsight, to build a demonstrator with two
slow, conventional, grey-value SLMs and to spend more effort on the
development of the illumination control algorithm and biological
experiments.

In \cma{holographic system} this context, with the aim of simplifying
the hardware, I built a holographic illumination system consisting of
a single phase-only SLM in the intermediate image plane. This enables
the simultaneous control of both the in-focus light distribution as
well as the illumination angles in the specimen. The SLM displays
diffraction gratings and its arrangement is such, that the first
diffraction order illuminates the pupil. The illumination angle in the
specimen can be adjusted by the grating period and direction while the
local irradiance is controlled with the grating contrast.


  % - holographie loest jedoch nicht das problem geringer ettendue (die moegliche
  %   ettendue muss ich mir genauer ueberlegen, sie haengt mit der
  %   anzahl der pixel des displays und den grating konstanten zusammen,
  %   die dargestellt werden koennen, da das system off-axis betrieben
  %   werden muss, wird die ettendue geviertelt)

Unfortunately the phase-only SLM that I used for the experiments
suffers from cross-talk between pixels, a non-linear transfer function
and temporal fluctuations of the displayed phase pattern. It was
uncertain whether these problems could be circumvented. Especially
higher orders which are generated by the device's non-linearity are a
problem when they reach the sample. Furthremore, it seems particularly
difficult to project a grating with small period into the sample
because this requires the superposition of two phase gratings on the
SLM --- a formidable task in the light of its  FIXME probleme.

Projecting grating patterns is necessary, because for my illumination
algorithm I need a reasonably good measurement of the
three-dimensional fluorophore distribution. For many specimen
structured illumination is necessary to remove out-of-focus light from
the raw images and obtain optical sections. Other phase SLMs which
became available more recently have a much better performance and
could presumably be used to construct a holographic spatio-angular
illumination device.

The \cma{sectioning by structured illumination} main prototype of our
project with two SLM, as described in chapter \ref{sec:dev1}, is more
suitable for structured illumination. The period on the focal plane
SLM and the illumination aperture defined by the pupil plane SLM can
be selected for best possible contrast of the in-focus light
pattern. Optically sectioned images can then be calculated with
various methods. The HiLo method proposed by Jerome Mertz and best
documented in \cite{Mertz2010} is preferable to others as only two
exposures per slice are necessary. Since images in our system are
taken in rapid succession and movement artifacts are unlikely, we
developed a variant of the HiLo method. In contrast to the original,
which uses one uniformly illuminated image and one with structured
illumination, we use two structured illumination images leading to an
improved signal-to-noise ratio.

During my work on the project \cma{sCMOS --- new camera technology} a
much improved camera technology (sCMOS) came to market. No such camera
was used for measurements in this work. It could, however, be added to
our system without substantial changes.

I use \cma{Arduino for control electronics} an Arduino microcontroller
for electronic synchronization. This cheap and easy to use electronics
platform has been used for several years in our lab and is
particularly useful for synchronization of multiple devices. The
source code for the Arduino microcontroller is often short and
relatively easy to read. This controller is thus well suited to
document the logic in our synchronization circuits and can be easily
understood and extended by new members of our group.

During this work, I used many different electronic devices (SLM:
Hamamatsu, Holoeye, ForthDD, Texas Instruments, Fraunhofer, cameras:
Andor (Clara, IXon2, IXon3, IXon Ultra, Neo sCMOS), Photometrics
Cascade II, Hamamatsu (Orca Flash 2.8 and 4.0), Logitech Pro 9000, and
more). I noticed that construction and debugging effort depend very
much on the quality of the documentation. If documentation is
insufficient, which unfortunately is often the case, then it helps if
communication is done with open standards (USB video device class,
Ethernet).

Particularly positively I was surprised by the Texas Instruments
DMD. The SLM development kit (DLP LightCrafter, YoungOptics) is very
mature \citep{Guide2012}, contains open source software and high
quality documentation explaining even the control registers of
individual chips.

Unlike the Fraunhofe micromirror array (as described in section
\ref{sec:mma}), the Texas Instruments digital micromirrors tilt around
their diagonals. For the 0.3~WVGA DMD, that is used in my development
kit, the pixels are addressed in a diagonal pattern but can be
illuminated parallel to one of the edges of the device. This
simplifies building the setup at the expense of a slightly more
complicated software control. The larger DMD devices can be addressed
more easily but must be illuminated in an angle of $45\degree$
relative to the device.

While working with the kit I was able to implement
features within three days, for which I spent several months of
reverse engineering and trial and error on devices of other
manufacturers --- most notably, controlling individual frames at the
fastest possible update rate (1440 frames per second) via HDMI. If I
had known this before, I would have designed the prototype differently
and I would have accepted some drawback regarding optical performance.


I \cma{Open hardware is a good thing} am not content with the current
state of scientific cameras because all of them gave me problems with
incompatible or unstable drivers. Therefore, I hope that there will be
more projects that open their resources to the public, such as Marc
Levoy's Franken Camera \citep{Adams2010}; or that the manufacturers of
the ever-improving consumer cameras document and disclose the
protocols for disabling automatic image processing and accessing raw
sensor data for their devices (as with the Logitech Pro 9000).


%Fu2011

Both our \cma{results of existing control software} prototype and the
software for illumination optimization have been designed for the
observation of cells in a developing \celegans\ embryo. So far, I was
able to demonstrate spatio-angular illumination on static, non-living
samples but I have not yet applied the method on living
organisms. Here, the main problem is that the image upload, especially
to the focal plane SLM, takes disproportionally long.

\section{Outlook}

If \cma{proposition for an optogenetics experiment} the sample does
not change very fast, and plenty of time is available to upload images
into the SLM controllers, then the current prototype allows
experiments with rapidly changing illumination patterns (about 1000
fps is attainable). One interesting biological experiment would be
similar to \cite{Branco2010}. There, synapses were excited by moving a
focal spot along one linear dendrite and its response was recorded as
a function of the speed of the focal spot. With our system, two
branches of a dendrite could be stimulated simultaneously. Thereby,
the response of the junction could be investigated.

The \cma{next steps for control software} algorithm for the
optimization of the illumination patterns can still be improved. So
far, I assume that the sample can be represented well by spheres. The
nuclei in each slice are illuminated individually and the algorithm
finds illumination angles so that exposure of out-of-focus nuclei is
avoided. An obvious improvement would be to find nuclei that can be
illuminated with similar angles and group them for simultaneous
exposure. Even better would be an algorithm in which the specimen is
not represented as solid bodies but works directly on stacks of
optical sections. In a first simple experiment, using the
computational power of graphics processing units, I could show that
the extensive calculations can be carried out in reasonable time
frames. (FIXME maybe mention this in in main text and add appendix)

\cma{maximum likelihood deconvolution} 

Weitere Untersuchungen zur Datenauswertung waeren sehr nuetzlich. Wie
bereits in \ref{sec:pam} angedeutet, koennte man unter Kenntnis des
Mappings zwischen focal plane SLM und Kamera ein und der SLM pattern
ein komputerisiertes Descanning umsetzen, also eine Klassifizierung
der Rohbilddaten in in-focus und out-of-focus photonen. Dafuer waere
jedoch vermutlich ein genaueres Verstaendnis der Lichtverteilung im
Sample notwendig.
 In diesem zuammenhang waere es hilfreich zu simulieren.

 \cma{partial coherent simulation}  It would be interesting to simulate the
wave-optical image formation of the prototype with partial
coherence. This would answer the question how important the grey
levels of the micromirror array in the pupil-plane really are, and
whether or not we can replace it with a binary DMD.

A similar simulation should be used to investigate the influence of
field mask B0 and Fourier stop B1 on the contrast and the transfer
function of the schlierenoptics system.




% - eine genaue analyse einiger probleme mit wellenoptischer partiell
%   kohaerenter theorie steht noch aus und waere interessant (nach
%   wichtigkeit)

%   - partiell kohaerente simulation des mma im schlierenoptischen system

%     - sind graulevel vorteilhaft?

%     - wuerde ein mma, bei dem alle spiegel in dieselbe richtung kippen
%       die ettendue verdoppeln?

%   - partiell kohaerente simulation des mma im shearing
%     interferometrischen system

%     - was ist die maximale ettendue eines wollaston prismas?

%   - holographie methode mit extended source

  % - Denkbar waere auch ein scannendes konfokales Mikroskop, dass an
  %   die Beleuchtungswinkel an jedem Punkt kontrolliert (siehe
  %   fig:hourglass-all-b).  Bisher wurden in der Literatur nur Systeme
  %   beschrieben, die die Phase des Beleuchtungslicht in der Pupille
  %   aendern (FIXME ref). Eine Adaption dieser Systeme zu einem
  %   spatio-angularen ist naheliegend und ich schlage vor, derartige
  %   Systeme auch untersucht werden sollten. Die Kombination von CLEM,
  %   einem Ringdetektor (vielleicht mit UZI) koennte die Bildgebung im
  %   Inneren lebender Organe (z.B. Gehirn) verbessern.

\appendix
\include{appendix}
\bibliographystyle{abbrvnat}
\bibliography{literature}
%\bibliography{../All}
\end{document}


%%% Local Variables: 
%%% mode: latex
%%% TeX-master: t
%%% End: 
